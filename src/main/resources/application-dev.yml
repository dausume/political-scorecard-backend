# political-scorecard-backend/src/main/resources/application-local.yml
# This file is used to define the local environment configuration for the application, and is the default configuration file
# used when running the application.  This is because a production environment requires a custom configuration file to be secure
# and if the user cannot figure that part out, they should not be running the application in production mode.
spring:
  config:
    activate:
      on-profile: dev
  security:
    oauth2:
      resourceserver:
        jwt:
          # Replace with your Keycloak realm JWKS endpoint
          # Format: http://{keycloak-host}:{port}/realms/{realm-name}/protocol/openid-connect/certs
          # Using HTTP for internal Docker network communication (containers are already on private network)
          # to fetch JWK keys - this avoids SSL certificate issues between containers
          jwk-set-uri: ${KEYCLOAK_JWKS_URI:http://pol-keycloak:8080/realms/Political-Scorecard/protocol/openid-connect/certs}
          # Issuer URI must match the 'iss' claim in tokens (what Keycloak puts in the token)
          # Tokens are issued via the public URL (https://localhost:8443), so this must match
          issuer-uri: ${KEYCLOAK_ISSUER_URI:https://localhost:8443/realms/Political-Scorecard}

# Enable debug logging for OAuth2 and JWT validation
logging:
  level:
    org.springframework.security: DEBUG
    org.springframework.security.oauth2: DEBUG
    org.springframework.security.oauth2.jwt: DEBUG
    org.springframework.security.oauth2.server.resource: DEBUG
    com.nimbusds: DEBUG

app: # Default Application-specific build configuration goes here
  datasource:
    # MariaDB databases
    mariadb-primary:
      database-name: mysql  # mysql is the name of the base database for Database Administration on mariadb containers.
      url: jdbc:mariadb://psc-mariadb:3306/mysql
      username: psc-scorecard-server
      password: test
      driver-class-name: org.mariadb.jdbc.Driver
    scoring:
      database-name: psc_scoring_db
      url: jdbc:mariadb://psc-mariadb:3306/psc_scoring_db
      username: psc-scorecard-server
      password: test
      driver-class-name: org.mariadb.jdbc.Driver
    location:
      database-name: psc_location_db
      url: jdbc:mariadb://psc-mariadb:3306/psc_location_db
      username: psc-scorecard-server
      password: test
      driver-class-name: org.mariadb.jdbc.Driver
    # Redis databases
    # The primary database does not have a namespace, so it is not necessary to define one
    redis-primary:
      host: psc-redis
      port: 6379
      username: psc-server
      password: pscpassword
      database-index: 0
    geolocation:
      host: psc-redis
      port: 6379
      username: psc-server
      password: pscpassword
      namespace: geolocation
      database-index: 1
    scoringcache:
      host: psc-redis
      port: 6379
      username: psc-server
      password: pscpassword
      namespace: scoringcache
      database-index: 2